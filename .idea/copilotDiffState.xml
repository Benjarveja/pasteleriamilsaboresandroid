<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilssaboresandroid/navigation/AppNavHost.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilssaboresandroid/navigation/AppNavHost.kt" />
              <option name="originalContent" value="package com.example.pasteleriamilssaboresandroid.navigation&#10;&#10;import android.net.Uri&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.size&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.List&#10;import androidx.compose.material.icons.filled.Home&#10;import androidx.compose.material.icons.filled.Info&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material.icons.filled.ShoppingCart&#10;import androidx.compose.material3.Badge&#10;import androidx.compose.material3.BadgedBox&#10;import androidx.compose.material3.CenterAlignedTopAppBar&#10;import androidx.compose.material3.DropdownMenu&#10;import androidx.compose.material3.DropdownMenuItem&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.NavigationBar&#10;import androidx.compose.material3.NavigationBarItem&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.SnackbarHost&#10;import androidx.compose.material3.SnackbarHostState&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TopAppBarDefaults&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.compose.collectAsStateWithLifecycle&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.NavGraph.Companion.findStartDestination&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import coil.compose.rememberAsyncImagePainter&#10;import com.example.pasteleriamilssaboresandroid.PasteleriaApp&#10;import com.example.pasteleriamilssaboresandroid.data.repository.AssetsProductRepository&#10;import com.example.pasteleriamilssaboresandroid.ui.cart.CartScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.cart.CartViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.cart.CartViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.CheckoutScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.CheckoutViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.CheckoutViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.OrderConfirmationScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.ProcessingOrderScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.news.NewsScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductDetailScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductDetailViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductDetailViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductsScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductsViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductsViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.home.HomeScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.home.HomeViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.home.HomeViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.LoginScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.OrdersScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.ProfileScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.RegisterScreen&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.LoginResult&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.OrdersViewModel&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.OrdersViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.RegisterResult&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.UpdateResult&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.UserViewModel&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.UserViewModelFactory&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun AppNavHost(startDestination: String = Screen.Home.route) {&#10;    val navController = rememberNavController()&#10;    val context = LocalContext.current&#10;    val application = context.applicationContext as PasteleriaApp&#10;&#10;    val cartVM: CartViewModel = viewModel(factory = CartViewModelFactory(application.cartRepository))&#10;    val userVM: UserViewModel = viewModel(factory = UserViewModelFactory(application.userRepository))&#10;    val checkoutVM: CheckoutViewModel = viewModel(factory = CheckoutViewModelFactory(application.orderRepository))&#10;    val ordersVM: OrdersViewModel = viewModel(factory = OrdersViewModelFactory(application.orderRepository))&#10;    val homeVM: HomeViewModel = viewModel(factory = HomeViewModelFactory(application.productRepository))&#10;    val productsVM: ProductsViewModel = viewModel(factory = ProductsViewModelFactory(application.productRepository))&#10;&#10;    val cartUi by cartVM.ui.collectAsStateWithLifecycle()&#10;    val loginResult by userVM.loginResult.collectAsStateWithLifecycle()&#10;    val registerResult by userVM.registerResult.collectAsStateWithLifecycle()&#10;    val updateResult by userVM.updateResult.collectAsStateWithLifecycle()&#10;    val loggedInUser by userVM.loggedInUser.collectAsStateWithLifecycle()&#10;    val checkoutUi by checkoutVM.uiState.collectAsStateWithLifecycle()&#10;&#10;    val snackbarHostState = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    var showMenu by remember { mutableStateOf(false) }&#10;&#10;    val items = listOf(&#10;        BottomItem(Screen.Home.route, &quot;Inicio&quot;, Icons.Filled.Home),&#10;        BottomItem(Screen.Products.route, &quot;Productos&quot;, Icons.AutoMirrored.Filled.List),&#10;        BottomItem(Screen.News.route, &quot;Noticias&quot;, Icons.Filled.Info),&#10;        BottomItem(Screen.Cart.route, &quot;Carrito&quot;, Icons.Filled.ShoppingCart),&#10;    )&#10;&#10;    val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;    val currentDestination = navBackStackEntry?.destination&#10;    val showBottomBar = currentDestination?.route !in listOf(&#10;        Screen.LoginFlow.route, &#10;        Screen.Register.route, &#10;        Screen.Checkout.route, &#10;        &quot;order_confirmation&quot;,&#10;        &quot;processing_order&quot;&#10;    )&#10;&#10;    LaunchedEffect(checkoutUi.order) {&#10;        if (checkoutUi.order != null) {&#10;            navController.navigate(&quot;order_confirmation&quot;)&#10;        }&#10;    }&#10;&#10;    Scaffold(&#10;        snackbarHost = { SnackbarHost(hostState = snackbarHostState) },&#10;        topBar = {&#10;            if (showBottomBar) {&#10;                CenterAlignedTopAppBar(&#10;                    title = { Text(text = &quot;Pastelería MilSabores&quot;) },&#10;                    colors = TopAppBarDefaults.centerAlignedTopAppBarColors(&#10;                        containerColor = MaterialTheme.colorScheme.tertiary&#10;                    ),&#10;                    actions = {&#10;                        if (loggedInUser == null) {&#10;                            IconButton(onClick = { navController.navigate(Screen.LoginFlow.route) }) {&#10;                                Icon(Icons.Filled.Person, contentDescription = &quot;Login&quot;)&#10;                            }&#10;                        } else {&#10;                            Box {&#10;                                IconButton(onClick = { showMenu = !showMenu }) {&#10;                                    loggedInUser?.profilePictureUri?.let { uriString -&gt;&#10;                                        Image(&#10;                                            painter = rememberAsyncImagePainter(model = Uri.parse(uriString)),&#10;                                            contentDescription = &quot;User Profile Picture&quot;,&#10;                                            modifier = Modifier&#10;                                                .size(32.dp)&#10;                                                .clip(CircleShape),&#10;                                            contentScale = ContentScale.Crop&#10;                                        )&#10;                                    } ?: Icon(Icons.Filled.Person, contentDescription = &quot;User Menu&quot;)&#10;                                }&#10;                                DropdownMenu(&#10;                                    expanded = showMenu,&#10;                                    onDismissRequest = { showMenu = false }&#10;                                ) {&#10;                                    DropdownMenuItem(&#10;                                        text = { Text(&quot;Administrar Perfil&quot;) },&#10;                                        onClick = {&#10;                                            navController.navigate(Screen.Profile.route)&#10;                                            showMenu = false&#10;                                        }&#10;                                    )&#10;                                    DropdownMenuItem(&#10;                                        text = { Text(&quot;Ver Pedidos&quot;) },&#10;                                        onClick = {&#10;                                            navController.navigate(Screen.Orders.route)&#10;                                            showMenu = false&#10;                                        }&#10;                                    )&#10;                                    DropdownMenuItem(&#10;                                        text = { Text(&quot;Cerrar Sesión&quot;) },&#10;                                        onClick = {&#10;                                            userVM.logout()&#10;                                            showMenu = false&#10;                                        }&#10;                                    )&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;        },&#10;        bottomBar = {&#10;            if (showBottomBar) {&#10;                NavigationBar {&#10;                    items.forEach { item -&gt;&#10;                        val selected = currentDestination?.hierarchy?.any { it.route == item.route } == true&#10;                        NavigationBarItem(&#10;                            icon = {&#10;                                if (item.route == Screen.Cart.route) {&#10;                                    BadgedBox(&#10;                                        badge = {&#10;                                            if (cartUi.itemCount &gt; 0) {&#10;                                                Badge { Text(&quot;${cartUi.itemCount}&quot;) }&#10;                                            }&#10;                                        }&#10;                                    ) {&#10;                                        Icon(imageVector = item.icon, contentDescription = item.label)&#10;                                    }&#10;                                } else {&#10;                                    Icon(imageVector = item.icon, contentDescription = item.label)&#10;                                }&#10;                            },&#10;                            label = { Text(item.label) },&#10;                            selected = selected,&#10;                            onClick = {&#10;                                if (!selected) navController.navigate(item.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                    popUpTo(navController.graph.startDestinationId) { saveState = true }&#10;                                }&#10;                            }&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    ) { innerPadding -&gt;&#10;        Box(modifier = Modifier.padding(innerPadding)) {&#10;            NavHost(navController = navController, startDestination = startDestination) {&#10;                composable(Screen.Home.route) {&#10;                    HomeScreen(homeViewModel = homeVM, onLoginClick = { navController.navigate(Screen.LoginFlow.route) })&#10;                }&#10;                composable(Screen.LoginFlow.route) {&#10;                    LoginScreen(&#10;                        onLoginClick = { email, password -&gt; userVM.login(email, password) },&#10;                        onContinueAsGuestClick = { navController.popBackStack() },&#10;                        onRegisterClick = { navController.navigate(Screen.Register.route) },&#10;                        onBackClick = { navController.popBackStack() }&#10;                    )&#10;                }&#10;                composable(Screen.Register.route) {&#10;                    RegisterScreen(&#10;                        onRegisterClick = { firstName, lastName, email, password, phone, run, birthDate, region, comuna, street -&gt;&#10;                            userVM.registerUser(firstName, lastName, email, password, phone, run, birthDate, region, comuna, street)&#10;                        },&#10;                        onBackClick = { navController.popBackStack() }&#10;                    )&#10;                }&#10;                composable(Screen.Products.route) {&#10;                    ProductsScreen(&#10;                        productsVM = productsVM,&#10;                        cartVM = cartVM,&#10;                        onOpen = { id -&gt; navController.navigate(&quot;product/$id&quot;) },&#10;                        onShowSnackbar = { message -&gt;&#10;                            scope.launch { snackbarHostState.showSnackbar(message) }&#10;                        }&#10;                    )&#10;                }&#10;                composable(Screen.News.route) { NewsScreen() }&#10;                composable(Screen.Cart.route) {&#10;                    CartScreen(&#10;                        cartVM = cartVM,&#10;                        onCheckout = { navController.navigate(Screen.Checkout.route) }&#10;                    )&#10;                }&#10;                composable(Screen.Checkout.route) {&#10;                    if (checkoutUi.isLoading) {&#10;                        ProcessingOrderScreen()&#10;                    } else {&#10;                        CheckoutScreen(&#10;                            cartVM = cartVM,&#10;                            userVM = userVM,&#10;                            checkoutVM = checkoutVM,&#10;                            onFinish = {&#10;                                checkoutVM.processOrder(cartUi.items, loggedInUser)&#10;                            },&#10;                            onBack = { navController.popBackStack() }&#10;                        )&#10;                    }&#10;                }&#10;                composable(&quot;order_confirmation&quot;) { &#10;                    checkoutUi.order?.let {&#10;                        OrderConfirmationScreen(order = it) {&#10;                            cartVM.clear()&#10;                            navController.navigate(Screen.Home.route) {&#10;                                popUpTo(navController.graph.findStartDestination().id) {&#10;                                    inclusive = true&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;                composable(Screen.ProductDetail.route) { backStackEntry -&gt;&#10;                    val id = backStackEntry.arguments?.getString(Screen.ProductDetail.ID) ?: &quot;&quot;&#10;                    val productDetailVM: ProductDetailViewModel = viewModel(&#10;                        factory = ProductDetailViewModelFactory(application.productRepository, id)&#10;                    )&#10;                    ProductDetailScreen(&#10;                        productDetailVM = productDetailVM,&#10;                        cartVM = cartVM,&#10;                        onBack = { navController.popBackStack() }&#10;                    )&#10;                }&#10;                composable(Screen.Profile.route) {&#10;                    ProfileScreen(userViewModel = userVM)&#10;                }&#10;                composable(Screen.Orders.route) {&#10;                    OrdersScreen(ordersViewModel = ordersVM, userViewModel = userVM)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(loggedInUser, currentDestination) {&#10;        if (loggedInUser == null) {&#10;            val protectedRoutes = listOf(Screen.Profile.route, Screen.Orders.route)&#10;            if (currentDestination?.route in protectedRoutes) {&#10;                navController.navigate(Screen.Home.route) {&#10;                    popUpTo(navController.graph.findStartDestination().id) {&#10;                        inclusive = true&#10;                    }&#10;                    launchSingleTop = true&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(loginResult) {&#10;        when (val result = loginResult) {&#10;            is LoginResult.Success -&gt; {&#10;                navController.popBackStack()&#10;                userVM.resetLoginState()&#10;            }&#10;            is LoginResult.Error -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(result.message) }&#10;                userVM.resetLoginState()&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(registerResult) {&#10;        when (val result = registerResult) {&#10;            is RegisterResult.Success -&gt; {&#10;                navController.popBackStack()&#10;                userVM.resetRegisterState()&#10;            }&#10;            is RegisterResult.Error -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(result.message) }&#10;                userVM.resetRegisterState()&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(updateResult) {&#10;        when (val result = updateResult) {&#10;            is UpdateResult.Success -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(&quot;Perfil actualizado correctamente&quot;) }&#10;                userVM.resetUpdateState()&#10;            }&#10;            is UpdateResult.Error -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(result.message) }&#10;                userVM.resetUpdateState()&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.pasteleriamilssaboresandroid.navigation&#10;&#10;import android.net.Uri&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.size&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.List&#10;import androidx.compose.material.icons.filled.Home&#10;import androidx.compose.material.icons.filled.Info&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material.icons.filled.ShoppingCart&#10;import androidx.compose.material3.Badge&#10;import androidx.compose.material3.BadgedBox&#10;import androidx.compose.material3.CenterAlignedTopAppBar&#10;import androidx.compose.material3.DropdownMenu&#10;import androidx.compose.material3.DropdownMenuItem&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.NavigationBar&#10;import androidx.compose.material3.NavigationBarItem&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.SnackbarHost&#10;import androidx.compose.material3.SnackbarHostState&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TopAppBarDefaults&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.compose.collectAsStateWithLifecycle&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.NavGraph.Companion.findStartDestination&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import coil.compose.rememberAsyncImagePainter&#10;import com.example.pasteleriamilssaboresandroid.PasteleriaApp&#10;import com.example.pasteleriamilssaboresandroid.data.repository.AssetsProductRepository&#10;import com.example.pasteleriamilssaboresandroid.ui.cart.CartScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.cart.CartViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.cart.CartViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.CheckoutScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.CheckoutViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.CheckoutViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.OrderConfirmationScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.checkout.ProcessingOrderScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.news.NewsScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductDetailScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductDetailViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductDetailViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductsScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductsViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.products.ProductsViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.home.HomeScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.home.HomeViewModel&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.home.HomeViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.LoginScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.OrdersScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.ProfileScreen&#10;import com.example.pasteleriamilssaboresandroid.ui.theme.screen.user.RegisterScreen&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.LoginResult&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.OrdersViewModel&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.OrdersViewModelFactory&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.RegisterResult&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.UpdateResult&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.UserViewModel&#10;import com.example.pasteleriamilssaboresandroid.viewmodel.UserViewModelFactory&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun AppNavHost(startDestination: String = Screen.Home.route) {&#10;    val navController = rememberNavController()&#10;    val context = LocalContext.current&#10;    val application = context.applicationContext as PasteleriaApp&#10;&#10;    val cartVM: CartViewModel = viewModel(factory = CartViewModelFactory(application.cartRepository))&#10;    val userVM: UserViewModel = viewModel(factory = UserViewModelFactory(application.authRepository))&#10;    val checkoutVM: CheckoutViewModel = viewModel(factory = CheckoutViewModelFactory(application.orderRepository))&#10;    val ordersVM: OrdersViewModel = viewModel(factory = OrdersViewModelFactory(application.orderRepository))&#10;    val homeVM: HomeViewModel = viewModel(factory = HomeViewModelFactory(application.productRepository))&#10;    val productsVM: ProductsViewModel = viewModel(factory = ProductsViewModelFactory(application.productRepository))&#10;&#10;    val cartUi by cartVM.ui.collectAsStateWithLifecycle()&#10;    val loginResult by userVM.loginResult.collectAsStateWithLifecycle()&#10;    val registerResult by userVM.registerResult.collectAsStateWithLifecycle()&#10;    val updateResult by userVM.updateResult.collectAsStateWithLifecycle()&#10;    val loggedInUser by userVM.loggedInUser.collectAsStateWithLifecycle()&#10;    val checkoutUi by checkoutVM.uiState.collectAsStateWithLifecycle()&#10;&#10;    val snackbarHostState = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    var showMenu by remember { mutableStateOf(false) }&#10;&#10;    val items = listOf(&#10;        BottomItem(Screen.Home.route, &quot;Inicio&quot;, Icons.Filled.Home),&#10;        BottomItem(Screen.Products.route, &quot;Productos&quot;, Icons.AutoMirrored.Filled.List),&#10;        BottomItem(Screen.News.route, &quot;Noticias&quot;, Icons.Filled.Info),&#10;        BottomItem(Screen.Cart.route, &quot;Carrito&quot;, Icons.Filled.ShoppingCart),&#10;    )&#10;&#10;    val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;    val currentDestination = navBackStackEntry?.destination&#10;    val showBottomBar = currentDestination?.route !in listOf(&#10;        Screen.LoginFlow.route, &#10;        Screen.Register.route, &#10;        Screen.Checkout.route, &#10;        &quot;order_confirmation&quot;,&#10;        &quot;processing_order&quot;&#10;    )&#10;&#10;    LaunchedEffect(checkoutUi.order) {&#10;        if (checkoutUi.order != null) {&#10;            navController.navigate(&quot;order_confirmation&quot;)&#10;        }&#10;    }&#10;&#10;    Scaffold(&#10;        snackbarHost = { SnackbarHost(hostState = snackbarHostState) },&#10;        topBar = {&#10;            if (showBottomBar) {&#10;                CenterAlignedTopAppBar(&#10;                    title = { Text(text = &quot;Pastelería MilSabores&quot;) },&#10;                    colors = TopAppBarDefaults.centerAlignedTopAppBarColors(&#10;                        containerColor = MaterialTheme.colorScheme.tertiary&#10;                    ),&#10;                    actions = {&#10;                        if (loggedInUser == null) {&#10;                            IconButton(onClick = { navController.navigate(Screen.LoginFlow.route) }) {&#10;                                Icon(Icons.Filled.Person, contentDescription = &quot;Login&quot;)&#10;                            }&#10;                        } else {&#10;                            Box {&#10;                                IconButton(onClick = { showMenu = !showMenu }) {&#10;                                    loggedInUser?.profilePictureUri?.let { uriString -&gt;&#10;                                        Image(&#10;                                            painter = rememberAsyncImagePainter(model = Uri.parse(uriString)),&#10;                                            contentDescription = &quot;User Profile Picture&quot;,&#10;                                            modifier = Modifier&#10;                                                .size(32.dp)&#10;                                                .clip(CircleShape),&#10;                                            contentScale = ContentScale.Crop&#10;                                        )&#10;                                    } ?: Icon(Icons.Filled.Person, contentDescription = &quot;User Menu&quot;)&#10;                                }&#10;                                DropdownMenu(&#10;                                    expanded = showMenu,&#10;                                    onDismissRequest = { showMenu = false }&#10;                                ) {&#10;                                    DropdownMenuItem(&#10;                                        text = { Text(&quot;Administrar Perfil&quot;) },&#10;                                        onClick = {&#10;                                            navController.navigate(Screen.Profile.route)&#10;                                            showMenu = false&#10;                                        }&#10;                                    )&#10;                                    DropdownMenuItem(&#10;                                        text = { Text(&quot;Ver Pedidos&quot;) },&#10;                                        onClick = {&#10;                                            navController.navigate(Screen.Orders.route)&#10;                                            showMenu = false&#10;                                        }&#10;                                    )&#10;                                    DropdownMenuItem(&#10;                                        text = { Text(&quot;Cerrar Sesión&quot;) },&#10;                                        onClick = {&#10;                                            userVM.logout()&#10;                                            showMenu = false&#10;                                        }&#10;                                    )&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;        },&#10;        bottomBar = {&#10;            if (showBottomBar) {&#10;                NavigationBar {&#10;                    items.forEach { item -&gt;&#10;                        val selected = currentDestination?.hierarchy?.any { it.route == item.route } == true&#10;                        NavigationBarItem(&#10;                            icon = {&#10;                                if (item.route == Screen.Cart.route) {&#10;                                    BadgedBox(&#10;                                        badge = {&#10;                                            if (cartUi.itemCount &gt; 0) {&#10;                                                Badge { Text(&quot;${cartUi.itemCount}&quot;) }&#10;                                            }&#10;                                        }&#10;                                    ) {&#10;                                        Icon(imageVector = item.icon, contentDescription = item.label)&#10;                                    }&#10;                                } else {&#10;                                    Icon(imageVector = item.icon, contentDescription = item.label)&#10;                                }&#10;                            },&#10;                            label = { Text(item.label) },&#10;                            selected = selected,&#10;                            onClick = {&#10;                                if (!selected) navController.navigate(item.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                    popUpTo(navController.graph.startDestinationId) { saveState = true }&#10;                                }&#10;                            }&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    ) { innerPadding -&gt;&#10;        Box(modifier = Modifier.padding(innerPadding)) {&#10;            NavHost(navController = navController, startDestination = startDestination) {&#10;                composable(Screen.Home.route) {&#10;                    HomeScreen(homeViewModel = homeVM, onLoginClick = { navController.navigate(Screen.LoginFlow.route) })&#10;                }&#10;                composable(Screen.LoginFlow.route) {&#10;                    LoginScreen(&#10;                        onLoginClick = { email, password -&gt; userVM.login(email, password) },&#10;                        onContinueAsGuestClick = { navController.popBackStack() },&#10;                        onRegisterClick = { navController.navigate(Screen.Register.route) },&#10;                        onBackClick = { navController.popBackStack() }&#10;                    )&#10;                }&#10;                composable(Screen.Register.route) {&#10;                    RegisterScreen(&#10;                        onRegisterClick = { firstName, lastName, email, password, phone, run, birthDate, region, comuna, street -&gt;&#10;                            userVM.registerUser(firstName, lastName, email, password, phone, run, birthDate, region, comuna, street)&#10;                        },&#10;                        onBackClick = { navController.popBackStack() }&#10;                    )&#10;                }&#10;                composable(Screen.Products.route) {&#10;                    ProductsScreen(&#10;                        productsVM = productsVM,&#10;                        cartVM = cartVM,&#10;                        onOpen = { id -&gt; navController.navigate(&quot;product/$id&quot;) },&#10;                        onShowSnackbar = { message -&gt;&#10;                            scope.launch { snackbarHostState.showSnackbar(message) }&#10;                        }&#10;                    )&#10;                }&#10;                composable(Screen.News.route) { NewsScreen() }&#10;                composable(Screen.Cart.route) {&#10;                    CartScreen(&#10;                        cartVM = cartVM,&#10;                        onCheckout = { navController.navigate(Screen.Checkout.route) }&#10;                    )&#10;                }&#10;                composable(Screen.Checkout.route) {&#10;                    if (checkoutUi.isLoading) {&#10;                        ProcessingOrderScreen()&#10;                    } else {&#10;                        CheckoutScreen(&#10;                            cartVM = cartVM,&#10;                            userVM = userVM,&#10;                            checkoutVM = checkoutVM,&#10;                            onFinish = {&#10;                                checkoutVM.processOrder(cartUi.items, loggedInUser)&#10;                            },&#10;                            onBack = { navController.popBackStack() }&#10;                        )&#10;                    }&#10;                }&#10;                composable(&quot;order_confirmation&quot;) { &#10;                    checkoutUi.order?.let {&#10;                        OrderConfirmationScreen(order = it) {&#10;                            cartVM.clear()&#10;                            navController.navigate(Screen.Home.route) {&#10;                                popUpTo(navController.graph.findStartDestination().id) {&#10;                                    inclusive = true&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;                composable(Screen.ProductDetail.route) { backStackEntry -&gt;&#10;                    val id = backStackEntry.arguments?.getString(Screen.ProductDetail.ID) ?: &quot;&quot;&#10;                    val productDetailVM: ProductDetailViewModel = viewModel(&#10;                        factory = ProductDetailViewModelFactory(application.productRepository, id)&#10;                    )&#10;                    ProductDetailScreen(&#10;                        productDetailVM = productDetailVM,&#10;                        cartVM = cartVM,&#10;                        onBack = { navController.popBackStack() }&#10;                    )&#10;                }&#10;                composable(Screen.Profile.route) {&#10;                    ProfileScreen(userViewModel = userVM)&#10;                }&#10;                composable(Screen.Orders.route) {&#10;                    OrdersScreen(ordersViewModel = ordersVM, userViewModel = userVM)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(loggedInUser, currentDestination) {&#10;        if (loggedInUser == null) {&#10;            val protectedRoutes = listOf(Screen.Profile.route, Screen.Orders.route)&#10;            if (currentDestination?.route in protectedRoutes) {&#10;                navController.navigate(Screen.Home.route) {&#10;                    popUpTo(navController.graph.findStartDestination().id) {&#10;                        inclusive = true&#10;                    }&#10;                    launchSingleTop = true&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(loginResult) {&#10;        when (val result = loginResult) {&#10;            is LoginResult.Success -&gt; {&#10;                navController.popBackStack()&#10;                userVM.resetLoginState()&#10;            }&#10;            is LoginResult.Error -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(result.message) }&#10;                userVM.resetLoginState()&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(registerResult) {&#10;        when (val result = registerResult) {&#10;            is RegisterResult.Success -&gt; {&#10;                navController.popBackStack()&#10;                userVM.resetRegisterState()&#10;            }&#10;            is RegisterResult.Error -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(result.message) }&#10;                userVM.resetRegisterState()&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;&#10;    LaunchedEffect(updateResult) {&#10;        when (val result = updateResult) {&#10;            is UpdateResult.Success -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(&quot;Perfil actualizado correctamente&quot;) }&#10;                userVM.resetUpdateState()&#10;            }&#10;            is UpdateResult.Error -&gt; {&#10;                scope.launch { snackbarHostState.showSnackbar(result.message) }&#10;                userVM.resetUpdateState()&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilssaboresandroid/viewmodel/UserViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilssaboresandroid/viewmodel/UserViewModel.kt" />
              <option name="originalContent" value="package com.example.pasteleriamilssaboresandroid.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.pasteleriamilssaboresandroid.data.database.user.User&#10;import com.example.pasteleriamilssaboresandroid.data.database.user.UserRepository&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.flow.Flow&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.flow.update&#10;import kotlinx.coroutines.launch&#10;import kotlinx.coroutines.withContext&#10;&#10;sealed class LoginResult {&#10;    object Idle : LoginResult()&#10;    object Success : LoginResult()&#10;    data class Error(val message: String) : LoginResult()&#10;}&#10;&#10;sealed class RegisterResult {&#10;    object Idle : RegisterResult()&#10;    object Success : RegisterResult()&#10;    data class Error(val message: String) : RegisterResult()&#10;}&#10;&#10;sealed class UpdateResult {&#10;    object Idle : UpdateResult()&#10;    object Success : UpdateResult()&#10;    data class Error(val message: String) : UpdateResult()&#10;}&#10;&#10;class UserViewModel(private val repository: UserRepository) : ViewModel() {&#10;&#10;    private val _loginResult = MutableStateFlow&lt;LoginResult&gt;(LoginResult.Idle)&#10;    val loginResult: StateFlow&lt;LoginResult&gt; = _loginResult.asStateFlow()&#10;&#10;    private val _registerResult = MutableStateFlow&lt;RegisterResult&gt;(RegisterResult.Idle)&#10;    val registerResult: StateFlow&lt;RegisterResult&gt; = _registerResult.asStateFlow()&#10;&#10;    private val _updateResult = MutableStateFlow&lt;UpdateResult&gt;(UpdateResult.Idle)&#10;    val updateResult: StateFlow&lt;UpdateResult&gt; = _updateResult.asStateFlow()&#10;&#10;    private val _loggedInUser = MutableStateFlow&lt;User?&gt;(null)&#10;    val loggedInUser: StateFlow&lt;User?&gt; = _loggedInUser.asStateFlow()&#10;&#10;    fun getUser(email: String): Flow&lt;User&gt; {&#10;        return repository.getUser(email)&#10;    }&#10;&#10;    fun login(email: String, password: String) {&#10;        viewModelScope.launch {&#10;            val user = withContext(Dispatchers.IO) {&#10;                repository.findByEmail(email)&#10;            }&#10;            if (user == null) {&#10;                _loginResult.value = LoginResult.Error(&quot;User not found&quot;)&#10;            } else if (user.passwordHash != password) { // Plain text password check for now&#10;                _loginResult.value = LoginResult.Error(&quot;Invalid password&quot;)&#10;            } else {&#10;                _loggedInUser.value = user&#10;                _loginResult.value = LoginResult.Success&#10;            }&#10;        }&#10;    }&#10;&#10;    fun logout() {&#10;        _loggedInUser.value = null&#10;    }&#10;&#10;    fun resetLoginState() {&#10;        _loginResult.value = LoginResult.Idle&#10;    }&#10;&#10;    fun resetRegisterState() {&#10;        _registerResult.value = RegisterResult.Idle&#10;    }&#10;&#10;    fun resetUpdateState() {&#10;        _updateResult.value = UpdateResult.Idle&#10;    }&#10;&#10;    fun registerUser(&#10;        firstName: String,&#10;        lastName: String,&#10;        email: String,&#10;        password: String,&#10;        phone: String,&#10;        run: String,&#10;        birthDate: String,&#10;        region: String,&#10;        comuna: String,&#10;        street: String&#10;    ) {&#10;        viewModelScope.launch {&#10;            try {&#10;                withContext(Dispatchers.IO) {&#10;                    val user = User(&#10;                        firstName = firstName,&#10;                        lastName = lastName,&#10;                        email = email,&#10;                        passwordHash = password, // Remember to hash the password in a real app&#10;                        phone = phone,&#10;                        run = run,&#10;                        birthDate = birthDate,&#10;                        region = region,&#10;                        comuna = comuna,&#10;                        street = street&#10;                    )&#10;                    repository.insert(user)&#10;                }&#10;                _registerResult.value = RegisterResult.Success&#10;            } catch (e: Exception) {&#10;                _registerResult.value = RegisterResult.Error(&quot;Failed to register user: ${e.message}&quot;)&#10;            }&#10;        }&#10;    }&#10;&#10;    fun updateUser(user: User) {&#10;        viewModelScope.launch {&#10;            try {&#10;                withContext(Dispatchers.IO) {&#10;                    repository.updateUser(user)&#10;                }&#10;                _loggedInUser.value = user // Update logged in user state&#10;                _updateResult.value = UpdateResult.Success&#10;            } catch (e: Exception) {&#10;                _updateResult.value = UpdateResult.Error(&quot;Failed to update user: ${e.message}&quot;)&#10;            }&#10;        }&#10;    }&#10;&#10;    fun updateUserProfilePicture(userId: Int, uri: String) {&#10;        viewModelScope.launch {&#10;            try {&#10;                withContext(Dispatchers.IO) {&#10;                    repository.updateUserProfilePicture(userId, uri)&#10;                }&#10;                _loggedInUser.update { it?.copy(profilePictureUri = uri) }&#10;                _updateResult.value = UpdateResult.Success&#10;            } catch (e: Exception) {&#10;                _updateResult.value = UpdateResult.Error(&quot;Failed to update profile picture: ${e.message}&quot;)&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.pasteleriamilssaboresandroid.viewmodel&#13;&#10;&#13;&#10;import androidx.lifecycle.ViewModel&#13;&#10;import androidx.lifecycle.viewModelScope&#13;&#10;import com.example.pasteleriamilssaboresandroid.data.repository.AuthRepository&#13;&#10;import com.example.pasteleriamilssaboresandroid.domain.model.User&#13;&#10;import kotlinx.coroutines.flow.MutableStateFlow&#13;&#10;import kotlinx.coroutines.flow.StateFlow&#13;&#10;import kotlinx.coroutines.flow.asStateFlow&#13;&#10;import kotlinx.coroutines.launch&#13;&#10;&#13;&#10;sealed class LoginResult {&#13;&#10;    object Idle : LoginResult()&#13;&#10;    object Success : LoginResult()&#13;&#10;    data class Error(val message: String) : LoginResult()&#13;&#10;}&#13;&#10;&#13;&#10;sealed class RegisterResult {&#13;&#10;    object Idle : RegisterResult()&#13;&#10;    object Success : RegisterResult()&#13;&#10;    data class Error(val message: String) : RegisterResult()&#13;&#10;}&#13;&#10;&#13;&#10;class UserViewModel(private val authRepository: AuthRepository) : ViewModel() {&#13;&#10;&#13;&#10;    private val _loginResult = MutableStateFlow&lt;LoginResult&gt;(LoginResult.Idle)&#13;&#10;    val loginResult: StateFlow&lt;LoginResult&gt; = _loginResult.asStateFlow()&#13;&#10;&#13;&#10;    private val _registerResult = MutableStateFlow&lt;RegisterResult&gt;(RegisterResult.Idle)&#13;&#10;    val registerResult: StateFlow&lt;RegisterResult&gt; = _registerResult.asStateFlow()&#13;&#10;&#13;&#10;    private val _loggedInUser = MutableStateFlow&lt;User?&gt;(null)&#13;&#10;    val loggedInUser: StateFlow&lt;User?&gt; = _loggedInUser.asStateFlow()&#13;&#10;&#13;&#10;    fun login(email: String, password: String) {&#13;&#10;        viewModelScope.launch {&#13;&#10;            try {&#13;&#10;                val user = authRepository.login(email, password)&#13;&#10;                _loggedInUser.value = user&#13;&#10;                _loginResult.value = LoginResult.Success&#13;&#10;            } catch (e: Exception) {&#13;&#10;                _loginResult.value = LoginResult.Error(e.message ?: &quot;Unknown error&quot;)&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    fun logout() {&#13;&#10;        _loggedInUser.value = null&#13;&#10;    }&#13;&#10;&#13;&#10;    fun resetLoginState() {&#13;&#10;        _loginResult.value = LoginResult.Idle&#13;&#10;    }&#13;&#10;&#13;&#10;    fun resetRegisterState() {&#13;&#10;        _registerResult.value = RegisterResult.Idle&#13;&#10;    }&#13;&#10;&#13;&#10;    fun registerUser(&#13;&#10;        firstName: String,&#13;&#10;        lastName: String,&#13;&#10;        email: String,&#13;&#10;        password: String,&#13;&#10;        phone: String,&#13;&#10;        run: String?,&#13;&#10;        birthDate: String?,&#13;&#10;        region: String?,&#13;&#10;        comuna: String?,&#13;&#10;        street: String?&#13;&#10;    ) {&#13;&#10;        viewModelScope.launch {&#13;&#10;            try {&#13;&#10;                val user = authRepository.register(&#13;&#10;                    firstName,&#13;&#10;                    lastName,&#13;&#10;                    email,&#13;&#10;                    password,&#13;&#10;                    phone,&#13;&#10;                    run,&#13;&#10;                    birthDate,&#13;&#10;                    region,&#13;&#10;                    comuna,&#13;&#10;                    street&#13;&#10;                )&#13;&#10;                _loggedInUser.value = user&#13;&#10;                _registerResult.value = RegisterResult.Success&#13;&#10;            } catch (e: Exception) {&#13;&#10;                _registerResult.value = RegisterResult.Error(e.message ?: &quot;Unknown error&quot;)&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilssaboresandroid/viewmodel/UserViewModelFactory.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilssaboresandroid/viewmodel/UserViewModelFactory.kt" />
              <option name="originalContent" value="package com.example.pasteleriamilssaboresandroid.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.ViewModelProvider&#10;import com.example.pasteleriamilssaboresandroid.data.database.user.UserRepository&#10;&#10;class UserViewModelFactory(private val repository: UserRepository) : ViewModelProvider.Factory {&#10;    override fun &lt;T : ViewModel&gt; create(modelClass: Class&lt;T&gt;): T {&#10;        if (modelClass.isAssignableFrom(UserViewModel::class.java)) {&#10;            @Suppress(&quot;UNCHECKED_CAST&quot;)&#10;            return UserViewModel(repository) as T&#10;        }&#10;        throw IllegalArgumentException(&quot;Unknown ViewModel class&quot;)&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.pasteleriamilssaboresandroid.viewmodel&#13;&#10;&#13;&#10;import androidx.lifecycle.ViewModel&#13;&#10;import androidx.lifecycle.ViewModelProvider&#13;&#10;import com.example.pasteleriamilssaboresandroid.data.repository.AuthRepository&#10;&#10;class UserViewModelFactory(private val repository: AuthRepository) : ViewModelProvider.Factory {&#10;    override fun &lt;T : ViewModel&gt; create(modelClass: Class&lt;T&gt;): T {&#10;        if (modelClass.isAssignableFrom(UserViewModel::class.java)) {&#10;            @Suppress(&quot;UNCHECKED_CAST&quot;)&#10;            return UserViewModel(repository) as T&#10;        }&#13;&#10;        throw IllegalArgumentException(&quot;Unknown ViewModel class&quot;)&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>